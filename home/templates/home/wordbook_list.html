{% extends 'home/base.html' %}

{% block title %}„Éõ„Éº„É† - TANKORE{% endblock %}

{% block content %}
{% load static %}
<div class="index-layout">
    <!-- Â∑¶ÂÅ¥„Çµ„Ç§„Éâ„Éê„ÉºÔºà„Çø„Ç∞Ê§úÁ¥¢Ôºâ -->
    <aside class="tags-sidebar">
        <div class="tags-sidebar-sticky">
            <div class="tags-sidebar-header">
                {% if selected_tags or search_query %}
                    <a href="{% url 'wordbook_list' %}" class="tags-clear-btn">„ÇØ„É™„Ç¢</a>
                {% endif %}
            </div>
            
            <div class="tags-sidebar-scroll">
                {% if all_tags %}
                    <div class="tags-group">
                        <h4 class="tags-group-title">‰∫∫Ê∞ó„ÅÆ„Çø„Ç∞</h4>
                        <div class="tags-list">
                            {% for tag in all_tags|slice:":10" %}
                            <a href="{% url 'wordbook_list' %}?tag={{ tag.name|urlencode }}" 
                               class="tag-item {% if tag.name in selected_tag_names %}active{% endif %}">
                                <span class="tag-name">{{ tag.name }}</span>
                                <span class="tag-count">{{ tag.usage_count }}</span>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                    
                    {% if all_tags|length > 10 %}
                    <div class="tags-group">
                        <h4 class="tags-group-title">„Åô„Åπ„Å¶„ÅÆ„Çø„Ç∞</h4>
                        <div class="tags-list">
                            {% for tag in all_tags|slice:"10:" %}
                            <a href="{% url 'wordbook_list' %}?tag={{ tag.name|urlencode }}" 
                               class="tag-item {% if tag.name in selected_tag_names %}active{% endif %}">
                                <span class="tag-name">{{ tag.name }}</span>
                                <span class="tag-count">{{ tag.usage_count }}</span>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                {% else %}
                    <p class="tags-empty">„Çø„Ç∞„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                {% endif %}
            </div>
        </div>
    </aside>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="index-main">
        <!-- „É¢„Éê„Ç§„É´Áî®„Çø„Ç∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="mobile-tags-section">
            <div class="mobile-tags-header">
                <h4 class="mobile-tags-title">üè∑Ô∏è „Çø„Ç∞„ÅßÊ§úÁ¥¢</h4>
                {% if selected_tags or search_query %}
                    <a href="{% url 'wordbook_list' %}" class="tags-clear-btn">„ÇØ„É™„Ç¢</a>
                {% endif %}
            </div>
            <div class="mobile-tags-scroll">
                {% for tag in all_tags|slice:":15" %}
                <a href="{% url 'wordbook_list' %}?tag={{ tag.name|urlencode }}" 
                   class="mobile-tag-chip {% if tag.name in selected_tag_names %}active{% endif %}">
                    {{ tag.name }}
                    <span class="mobile-tag-count">{{ tag.usage_count }}</span>
                </a>
                {% empty %}
                <span style="color: #999; font-size: 0.85rem;">„Çø„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</span>
                {% endfor %}
            </div>
        </div>

        <!-- Ê§úÁ¥¢ÁµêÊûú„ÅÆË°®Á§∫ -->
        {% if is_filtered %}
            <div class="filter-result-info">
                <p>
                    {% if search_query %}„Äå{{ search_query }}„Äç{% endif %}
                    {% if selected_tags %}{% if search_query %}„Éª{% endif %}„Äå{% for tag in selected_tags %}{{ tag.name }}{% if not forloop.last %}„ÄÅ{% endif %}{% endfor %}„Äç{% endif %}
                    „Åß{{ popular_wordbooks.count|add:ai_wordbooks.count }}‰ª∂„ÅÆÂçòË™ûÂ∏≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü
                </p>
            </div>
        {% endif %}

        <!-- ‰∫∫Ê∞ó„ÅÆÂçòË™ûÂ∏≥„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <section class="wordbook-section">
            <h2 class="section-title">‰∫∫Ê∞ó„ÅÆÂçòË™ûÂ∏≥</h2>
            <div class="wordbook-grid">
                {% for wordbook in popular_wordbooks %}
                    <a href="{% url 'wordbook_detail' wordbook.pk %}" class="wordbook-card">
                        <div class="wordbook-image" style="background-color: {{ wordbook.get_background_color|default:'#fffff0' }};">
                            <img src="{{ wordbook.get_avatar_url }}" alt="{{ wordbook.user.username }}" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div class="wordbook-info">
                            <h3>{{ wordbook.title }}</h3>
                            <p class="card-count">{{ wordbook.card_count }}Êûö„Éª<img src="{% static 'home/images/like-3d.png' %}" alt="„ÅÑ„ÅÑ„Å≠" class="like-icon"> {{ wordbook.like_count|default:0 }}</p>
                        </div>
                    </a>
                {% empty %}
                    <p class="empty-message">„Åæ„Å†ÂçòË™ûÂ∏≥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                {% endfor %}
            </div>
        </section>

        <!-- AI„ÅÆÂçòË™ûÂ∏≥„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <section class="wordbook-section" style="margin-bottom: 250px;">
            <h2 class="section-title">AI„ÅÆÂçòË™ûÂ∏≥</h2>
            <div class="wordbook-grid">
                {% for wordbook in ai_wordbooks %}
                    <a href="{% url 'wordbook_detail' wordbook.pk %}" class="wordbook-card">
                        <div class="wordbook-image" style="background-color: {{ wordbook.get_background_color|default:'#fffff0' }};">
                            <img src="{{ wordbook.get_avatar_url }}" alt="{{ wordbook.user.username }}" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div class="wordbook-info">
                            <h3>{{ wordbook.title }}</h3>
                            <p class="card-count">{{ wordbook.card_count }}Êûö„Éª<img src="{% static 'home/images/like-3d.png' %}" alt="„ÅÑ„ÅÑ„Å≠" class="like-icon"> {{ wordbook.like_count|default:0 }}</p>
                        </div>
                    </a>
                {% empty %}
                    <p class="empty-message">„Åæ„Å†ÂçòË™ûÂ∏≥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                {% endfor %}
            </div>
        </section>
    </div>
</div>
{% endblock %}
