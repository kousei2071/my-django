{% extends 'home/base.html' %}
{% load static %}

{% block title %}ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† - TANKORE{% endblock %}

{% block content %}
<div class="edit-page-container">
    <div class="edit-box">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="edit-header">
            <h2 class="edit-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h2>
            <p class="edit-subtitle">ã‚ãªãŸã®æƒ…å ±ã‚’æ›´æ–°ã—ã¦ãã ã•ã„</p>
        </div>
        
        <form method="post" enctype="multipart/form-data" class="profile-edit-form">
            {% csrf_token %}
            
            <!-- ã‚¢ãƒã‚¿ãƒ¼ç·¨é›† -->
            <div class="edit-section">
                <label class="edit-label">ã‚¢ãƒã‚¿ãƒ¼ç”»åƒ</label>
                <div class="avatar-edit-area">
                    <div class="avatar-preview">
                        {% if profile.avatar %}
                            <img src="{{ profile.avatar.url }}" alt="ç¾åœ¨ã®ã‚¢ãƒã‚¿ãƒ¼" class="preview-image" id="avatar-preview">
                        {% else %}
                            <div class="preview-placeholder" id="avatar-preview">ç”»åƒ</div>
                        {% endif %}
                    </div>
                    <div class="avatar-upload-controls">
                        <input type="file" name="avatar" id="avatar" accept="image/*" class="file-input" onchange="previewImage(this)">
                        <label for="avatar" class="upload-btn">
                            <span>ğŸ“·</span> ç”»åƒã‚’é¸æŠ
                        </label>
                        <p class="upload-hint">æ¨å¥¨ã‚µã‚¤ã‚º: 200x200px</p>
                    </div>
                </div>
            </div>
            
            <!-- è¡¨ç¤ºå -->
            <div class="edit-section">
                <label for="display_name" class="edit-label">è¡¨ç¤ºå</label>
                <input type="text" 
                       name="display_name" 
                       id="display_name" 
                       value="{{ profile.display_name }}" 
                       placeholder="è¡¨ç¤ºåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" 
                       class="edit-input">
                <p class="input-hint">ç©ºã®å ´åˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆ{{ user.username }}ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
            
            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆè¡¨ç¤ºã®ã¿ï¼‰ -->
            <div class="edit-section">
                <label class="edit-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
                <div class="readonly-field">
                    <span class="readonly-value">{{ user.username }}</span>
                    <span class="readonly-badge">å¤‰æ›´ä¸å¯</span>
                </div>
            </div>
            
            <!-- è‡ªå·±ç´¹ä»‹ -->
            <div class="edit-section">
                <label for="bio" class="edit-label">è‡ªå·±ç´¹ä»‹</label>
                <textarea name="bio" 
                          id="bio" 
                          rows="5" 
                          placeholder="è‡ªå·±ç´¹ä»‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§200æ–‡å­—ï¼‰" 
                          class="edit-textarea"
                          maxlength="200">{{ profile.bio }}</textarea>
                <p class="input-hint">
                    <span id="bio-count">{{ profile.bio|length|default:0 }}</span>/200æ–‡å­—
                </p>
            </div>
            
            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="edit-actions">
                <button type="submit" class="save-btn">
                    <span>ğŸ’¾</span> å¤‰æ›´ã‚’ä¿å­˜
                </button>
                <a href="{% url 'my_wordbooks' %}" class="cancel-btn">
                    <span>âŒ</span> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// ã‚¢ãƒã‚¿ãƒ¼ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
function previewImage(input) {
    const preview = document.getElementById('avatar-preview');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            if (preview.tagName === 'IMG') {
                preview.src = e.target.result;
            } else {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'preview-image';
                img.id = 'avatar-preview';
                preview.parentNode.replaceChild(img, preview);
            }
        }
        
        reader.readAsDataURL(input.files[0]);
    }
}

// æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
const bioTextarea = document.getElementById('bio');
const bioCount = document.getElementById('bio-count');

if (bioTextarea && bioCount) {
    bioTextarea.addEventListener('input', function() {
        bioCount.textContent = this.value.length;
    });
}
</script>
{% endblock %}